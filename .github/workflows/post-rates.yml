name: Post USD & Market Rates (Forouzanfar)

on:
  schedule:
    # اجرا 3 بار در روز (UTC): 06:00, 12:00, 18:00
    # معادل تهران: حدود 09:30، 15:30، 21:30
    - cron: '0 6,12,18 * * *'
  workflow_dispatch:

jobs:
  post:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install deps
        run: pip install requests jdatetime hijri-converter
      - name: Run poster (rates)
        env:
          MODE: 'rates'
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          NAVASAN_API_KEY: ${{ secrets.NAVASAN_API_KEY }}
          TELEGRAM_CHANNEL: '@Foorouzanfar'
          TIMEZONE: 'Asia/Tehran'
          MESSAGE_HEADER: '📣 صرافی فروزانفر — بروزرسانی نرخ‌ها'
          SOURCE_LABEL: 'نوسان'
          HASHTAGS: '#دلار #یورو #سکه #طلا #حواله #صرافی_فروزانفر'
          CHANNEL_HANDLE: '@Foorouzanfar'
          INCLUDE_CATEGORIES: 'cash,remittance,melli,goldcoin'
          TOP_N_PER_CATEGORY: '3'
          MIN_CHANGE_TOMAN: '300'   # اگر می‌خواهی همیشه پست بده: '0'
        run: python rates_cron.py
