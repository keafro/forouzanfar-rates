name: Post USD rate to Telegram (Forouzanfar)

on:
  schedule:
    # 06:00, 12:00, 18:00 UTC â‰ˆ Ø­Ø¯ÙˆØ¯ 09:30ØŒ 15:30ØŒ 21:30 ØªÙ‡Ø±Ø§Ù†
    - cron: "0 6,12,18 * * *"
  workflow_dispatch: {}  # Ø¯Ú©Ù…Ù‡ Run workflow Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø¯Ø³ØªÛŒ

permissions:
  contents: read

concurrency:
  group: post-usd-forouzanfar
  cancel-in-progress: true

jobs:
  post:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: pip install requests

           - name: Run poster
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          NAVASAN_API_KEY: ${{ secrets.NAVASAN_API_KEY }}
          TELEGRAM_CHANNEL: "@Foorouzanfar"
          TIMEZONE: "Asia/Tehran"
          MESSAGE_HEADER: "ðŸ“£ ØµØ±Ø§ÙÛŒ ÙØ±ÙˆØ²Ø§Ù†ÙØ± â€” Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ù„Ø§Ø± Ø¢Ø²Ø§Ø¯"
          SOURCE_LABEL: "Ù†ÙˆØ³Ø§Ù†"
          HASHTAGS: "#Ø¯Ù„Ø§Ø± #Ù†Ø±Ø®_Ø¯Ù„Ø§Ø± #ØµØ±Ø§ÙÛŒ_ÙØ±ÙˆØ²Ø§Ù†ÙØ±"
          CHANNEL_HANDLE: "@Foorouzanfar"
          MIN_CHANGE_TOMAN: "0"   # Ù…Ø«Ù„Ø§ Ø§Ú¯Ø± Ø¨Ø°Ø§Ø±ÛŒ 300 => ÙÙ‚Ø· ÙˆÙ‚ØªÛŒ ØªØºÛŒÛŒØ± >= 300 ØªÙˆÙ…Ù† Ø¨ÙˆØ¯ØŒ Ù¾Ø³Øª Ø¨Ø¯Ù‡
        run: python rates_cron.py
