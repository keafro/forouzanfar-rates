name: Post USD & Market Rates to Telegram (Forouzanfar)

on:
  schedule:
    # اجرا 3 بار در روز (UTC): 06:00, 12:00, 18:00
    # معادل حدوداً تهران: 09:30، 15:30، 21:30
    - cron: '0 6,12,18 * * *'
  workflow_dispatch:

jobs:
  post:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install deps
        run: pip install requests

      - name: Run poster
        env:
          # --- Secrets (باید قبلاً در Settings > Secrets ساخته شوند) ---
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          NAVASAN_API_KEY: ${{ secrets.NAVASAN_API_KEY }}

          # --- تنظیمات پیام (دلخواه) ---
          TELEGRAM_CHANNEL: '@Foorouzanfar'
          TIMEZONE: 'Asia/Tehran'
          MESSAGE_HEADER: '📣 صرافی فروزانفر — بروزرسانی نرخ‌ها'
          SOURCE_LABEL: 'نوسان'
          HASHTAGS: '#دلار #یورو #سکه #طلا #حواله #صرافی_فروزانفر'
          CHANNEL_HANDLE: '@Foorouzanfar'

          # دسته‌ها: cash = اسکناس نقدی، remittance = حواله،
          # melli = صرافی ملی، goldcoin = سکه/طلا، crypto = رمزارز
          INCLUDE_CATEGORIES: 'cash,remittance,melli,goldcoin,crypto'

          # اگر بخواهی فقط وقتی تغییر دلار فروش تهران زیاد بود پست بده:
          # مقدار را به تومان بگذار (مثلا '300'). صفر یعنی همیشه ارسال.
          MIN_CHANGE_TOMAN: '0'
        run: python rates_cron.py
