name: Post USD & Market Rates (Forouzanfar)

on:
  schedule:
    # اجرا 3 بار در روز (UTC): 06:00, 12:00, 18:00
    # معادل تهران (UTC+3:30): 09:30، 15:30، 21:30
    - cron: '0 6,12,18 * * *'
  workflow_dispatch:

jobs:
  post:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install deps
        run: pip install requests jdatetime hijri-converter

      - name: Run poster (rates)
        env:
          MODE: 'rates'
          # --- Secrets: حتماً در Settings > Secrets ساخته باشی ---
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          NAVASAN_API_KEY: ${{ secrets.NAVASAN_API_KEY }}

          # --- تنظیمات پیام (دلخواه) ---
          TELEGRAM_CHANNEL: '@Foorouzanfar'
          TIMEZONE: 'Asia/Tehran'
          MESSAGE_HEADER: '📣 صرافی فروزانفر — بروزرسانی نرخ‌ها'
          SOURCE_LABEL: 'نوسان'
          HASHTAGS: '#دلار #یورو #سکه #طلا #حواله #صرافی_فروزانفر'
          CHANNEL_HANDLE: '@Foorouzanfar'

          # دسته‌ها: cash=اسکناس، remittance=حواله، melli=ملی، goldcoin=سکه/طلا، crypto=رمزارز
          INCLUDE_CATEGORIES: 'cash,remittance,melli,goldcoin,crypto'

          # هر دسته حداکثر چند ردیف نشان دهد (برای شلوغ نشدن پیام)
          TOP_N_PER_CATEGORY: '4'

          # اگر تغییر دلار فروش تهران کمتر از این مقدار (تومان) بود، ارسال نکند. صفر = همیشه ارسال.
          MIN_CHANGE_TOMAN: '0'
        run: python rates_cron.py
